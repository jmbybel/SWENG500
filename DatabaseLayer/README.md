#MongoDB database installation, configuration and usage

##Installation
https://docs.mongodb.com/manual/administration/install-enterprise/
The link should point to a copy tthat is not paid, if that changes, the community edition should be fine.

Follow the guide to install on your local machine.


###Install test
Once you have installed, run the "mongod" executable from the install location to start the database. 
If wanted, also run the "mongo" tool for console access to the database
Verify the health of the database by running the MongoDBPersistenceTest JUnits, which will be looking for a functional MongoDB instance running on localhost:27017

for additional reference: http://mongodb.github.io/mongo-java-driver/3.4/driver/getting-started/quick-start/

##Configuration
This section is being written with the assumption that we will have a build script set configuration values up later.

the mongod executable can be passed a configuration file via the --config parameter and a relative path, i.e. "mongod --config /etc/mongod.conf"
so locate initial config changes there.

a custom port number is passed to the mongod executable via --port #####

The database name currently matches our project -- sweng500
This can be changed by updating MongoDbPersistence, aDatabase = mongoClient.getDB("sweng500");
In fact, the string passed to that should be moved to a build file later in the project's life.

reference this for additional stuff: https://docs.mongodb.com/manual/reference/configuration-options/

##Data Design
In keeping with the denormalized data encouraged by Mongo, there should only be two collections needed

The Device collection, containing the device, all of its sensors, and the current payload configuration of the sensor. The UI layer, via the API, will run CRUD operations on the Devices to fetch and save all of that in a shot. The PayloadGenerator project and endpoint testing tool does not care about this at all.

The Test Request/Response collection, which will need a finalized name. This will be generated by the Payload Generator/Test Framework. It will contain a payload - a snapshot of a Sensor's paylaod configuration - and a response, whatever comes back from the test endpoint supplied by the payload. This is written to only by the Test Framework layer. The UI will only have read (and maybe batch delete) access to this.

Since the Sensor is not a separate collection, it will not have an ID generated by the Mongo database. To relate a Payload in the Request/Response collection uniquely to a Sensor, the Sensor will need to generate an ID in code before it is saved to the database. To keep it unique, it should be a hash code containing the parent Device and the system date/time it was created (and other properties if desired). That should be unique enough for the UI side to run queries against. 

The Payload would then contain a copy of the sensor's created ID.

The code invoked by the UI when looking up request/response tests for a given sensor would roughly look like:
	(assuming we are already looking at the payload request response collection)
	collection.find("sensorId", new Document("$eq", sensorId));


As of the writing of this, some things are not fully in place to support this. 

## To be deprecated
API and lower access to anything except Sensor and Payload Request/Response

##Console basics
you might need to debug things directly in the database if your data is not coming across well.
pop open the mongo executable and try the following

Point the database at our specific DB and not its default
	use sweng500
Get everything from the Device collection
	db.device.find()
Get something from the Device collection with the name sample
	db.device.find( {
		name: sample
	})
Other stuff
	db.device.updateOne
	db.device.updateMany
	db.device.deleteOne
	db.device.deleteMany
	db.device.replaceOne
	
	
	

## Built With

* [MongoDB](http://mongodb.com/) - NoSQL database.
* [MongoJack](http://mongojack.com/) - Jackson JSON mapper with convenience methods for the Mongo database.
* [GSON] (https://github.com/google/gson) - Google's JSON-Object converter

## Versioning

We used [github](https://github.com/jmbybel/SWENG500). 

## Authors

* **Cory Perdue** - *Initial and continued setup of Data Generator* - [dk-csperdue](https://github.com/dk-csperdue)
* **Michael Cantu** - *Assistance working on and testing Data Generator* - [MichaelCantu93](https://github.com/MichaelCantu93)
* **David Lambl** - *Group member working on front end* - [davidlambl](https://github.com/davidlambl)
* **Jeremy Bybel** - *Group member working on database* - [jmbybel](https://github.com/jmbybel)
* **James Ward** - *Scrum Master* - [wardja28](https://github.com/wardja28)

See also the list of [contributors](https://github.com/jmbybel/SWENG500/graphs/contributors) who participated in this project.

## Acknowledgments

* Thanks to our Group 1 for all doing such great work!

